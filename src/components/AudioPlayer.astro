---
// src/components/AudioPlayer.astro
import 'plyr/dist/plyr.css';

export interface Props {
  src: string;
}

const { src } = Astro.props;
---

<audio class="custom-audio-player" controls src={src}>
  您的浏览器不支持音频播放。
</audio>

<script>
  async function initializePlyr() {
    try {
      const plyrModule = await import('plyr');
      const Plyr = (plyrModule as any).default;
      
      if (!Plyr) {
        console.error("Plyr library failed to load.");
        return;
      }
      
      const players = Array.from(document.querySelectorAll('.custom-audio-player'));
      
      players.forEach(player => {
        new Plyr(player as HTMLElement);
      });
    } catch (error) {
      console.error("Error initializing Plyr:", error);
    }
  }

  initializePlyr();
</script>

<style is:global>
  /* --- 默认 (亮色) 模式下的主题色 --- */
  :root {
    /* 这是播放进度条、音量条的主颜色 */
    --plyr-color-main: #6366f1; /* 您可以替换为您网站的主题色 */
  }

  /* --- 暗色模式下的样式 --- */
  /* 当 html 标签有 .dark 类时，以下样式生效 */
  .dark .plyr--audio {
    /* 播放器背景色 (例如：深灰色) */
    --plyr-background-color: #2d3748;

    /* 按钮和时间的颜色 (例如：浅灰色) */
    --plyr-control-color: #cbd5e0;

    /* 鼠标悬停在按钮上时的颜色 (例如：白色) */
    --plyr-control-color-hover: #ffffff;

    /* 时间进度条未播放部分的颜色 */
    --plyr-range-track-background: #4a5568;
  }
</style>