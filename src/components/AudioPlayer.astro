---
// src/components/AudioPlayer.astro
import 'plyr/dist/plyr.css';

export interface Props {
  src: string;
}

const { src } = Astro.props;
---

<audio class="custom-audio-player" controls src={src}>
  您的浏览器不支持音频播放。
</audio>

<script>
  async function initializePlyr() {
    try {
      // 动态导入 plyr 库。
      const plyrModule = await import('plyr');

      // 使用 `as any` 进行类型断言，绕过静态类型检查的错误。
      // 这告诉 TypeScript：“我知道 plyrModule 在运行时会有一个 .default 属性”。
      const Plyr = (plyrModule as any).default;
      
      if (!Plyr) {
        console.error("Plyr library failed to load.");
        return;
      }
      
      const players = Array.from(document.querySelectorAll('.custom-audio-player'));
      
      players.forEach(player => {
        new Plyr(player as HTMLElement);
      });
    } catch (error) {
      console.error("Error initializing Plyr:", error);
    }
  }

  initializePlyr();
</script>

<style is:global>
  :root {
    --plyr-color-main: #1877F2; 
  }
</style>