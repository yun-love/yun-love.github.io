---
// src/components/AudioPlayer.astro
import 'plyr/dist/plyr.css';

export interface Props {
  src: string;
}

const { src } = Astro.props;
---

<audio class="custom-audio-player" controls src={src}>
  您的浏览器不支持音频播放。
</audio>

<script>
  // 使用一个异步函数来初始化播放器
  async function initializePlyr() {
    try {
      // 动态导入 plyr 库。这可以避免静态检查时的模块解析问题。
      // `(await import('plyr')).default` 是获取模块默认导出的标准方式。
      const Plyr = (await import('plyr')).default;
      
      if (!Plyr) {
        console.error("Plyr library failed to load.");
        return;
      }

      // 寻找所有带有特定 class 的播放器元素
      const players = Array.from(document.querySelectorAll('.custom-audio-player'));

      // 为每个元素初始化一个新的 Plyr 实例
      players.forEach(player => {
        new Plyr(player as HTMLElement);
      });
    } catch (error) {
      console.error("Error initializing Plyr:", error);
    }
  }

  // 调用函数，开始执行初始化
  initializePlyr();
</script>

<style is:global>
  :root {
    /* 自定义主题颜色依然有效 */
    --plyr-color-main: #1877F2; 
  }
</style>